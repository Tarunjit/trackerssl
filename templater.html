<script src="app/bower_components/handlebars/handlebars.min.js"></script>
<script id="hello-world-template" type="text/x-handlebars-template">
    {{#if ssl}}
    	<h1 id="leadMessage">This website was served through SSL!</h1>
    	{{#if uniqueHosts}}
	    	<p id="trackerCount"><strong>{{percentageSSL}}%</strong> of the trackers on this site could be protecting you.
	    	{{#if completeTrackersSSL}}
	    		Tell {{hostName}} to fix it.</p>
          <div id="widget">
            <div class="btn-o" data-scribe="component:button">
              <a href="https://twitter.com/intent/tweet?text=Thank%20you%20{{hostName}}%20for%20supporting%20SSL%20and%20doing%20your%20part%20to%20fight%20mass%20surveillance!%20%23trackerSSL" target="_blank" class="btn" id="b"><i></i><span class="label" id="l">Tweet</span></a>
            </div>
          </div>
	    	{{else}}
	    		Tell {{hostName}} to fix it.</p></p>
          <div id="widget">
            <div class="btn-o" data-scribe="component:button">
              <a href="https://twitter.com/intent/tweet?text=Thank%20you%20{{hostName}}%20for%20supporting%20SSL%2C%20but%20since%20some%20of%20your%20trackers%20don%27t%2C%20it%20breaks%20your%20security!%20Might%20wanna%20fix%20that.%20%23trackerSSL" target="_blank" class="btn" id="b"><i></i><span class="label" id="l">Tweet</span></a>
            </div>
          </div>
	    	{{/if}}
	    {{else}}
	    	<p id="trackerCount">No 3rd party trackers on this site. Why don&lsquo;t you thank {{hostName}} for supporting SSL?</p>
        <div id="widget">
          <div class="btn-o" data-scribe="component:button">
            <a href="https://twitter.com/intent/tweet?text=Thank%20you%20{{hostName}}%20for%20supporting%20SSL%20and%20doing%20your%20part%20to%20fight%20mass%20surveillance!%20%23trackerSSL" target="_blank" class="btn" id="b"><i></i><span class="label" id="l">Tweet</span></a>
          </div>
        </div>
	    {{/if}}
    {{else}}
    	{{#if couldBeSSL}}
    		<h1 id="leadMessage">This website supports SSL but it&lsquo;s not the default!</h1>
    		{{#if uniqueHosts}}
		    	<p id="trackerCount"><strong>{{percentageSSL}}%</strong> of the trackers on this site could be protecting you.
		    	{{#if majorityTrackersSSL}}
		    		Tell {{hostName}} to fix it.</p></p>
            <div id="widget">
            <div class="btn-o" data-scribe="component:button">
              <a href="https://twitter.com/intent/tweet?text=Hey%20{{hostName}}%20Why%20don't%20you%20do%20your%20part%20in%20the%20fight%20against%20mass%20surveillance%20and%20enable%20HTTPS%20by%20default%3F%20%23trackerssl" target="_blank" class="btn" id="b"><i></i><span class="label" id="l">Tweet</span></a>
            </div>
          </div>
		    	{{else}}
		    		Tell {{hostName}} to fix it.</p></p>
            <div id="widget">
            <div class="btn-o" data-scribe="component:button">
              <a href="https://twitter.com/intent/tweet?text=Hey%20{{hostName}},%20most%20of%20your%20ad%20trackers%20don't%20support%20SSL.%20Consider%20some%20that%20do!%20Do%20your%20part%20in%20fighting%20mass%20surveillance.%20%23trackerSSL" target="_blank" class="btn" id="b"><i></i><span class="label" id="l">Tweet</span></a>
            </div>
          </div>
		    	{{/if}}
		    {{else}}
		    	<p id="trackerCount">No 3rd party trackers on this site.</p>
		    	<p>Since there are no third party dependencies preventing it, why don&lsquo;t you ask {{hostName}} to adopt SSL by default?</p>
          <div id="widget">
            <div class="btn-o" data-scribe="component:button">
              <a href="https://twitter.com/intent/tweet?text=Hey%20{{hostName}}%20Why%20don't%20you%20do%20your%20part%20in%20the%20fight%20against%20mass%20surveillance%20and%20enable%20HTTPS%20by%20default%3F%20%23trackerssl" target="_blank" class="btn" id="b"><i></i><span class="label" id="l">Tweet</span></a>
            </div>
          </div>
		    {{/if}}
    	{{else}}
    		<h1 id="leadMessage">This website is insecure.</h1>
			{{#if uniqueHosts}}
		    	<p id="trackerCount"><strong>{{percentageSSL}}%</strong> of the trackers on this site could be protecting you.
		    	{{#if majorityTrackersSSL}}
		    		Tell {{hostName}} to fix it.</p>
            <div id="widget">
            <div class="btn-o" data-scribe="component:button">
              <a href="https://twitter.com/intent/tweet?text=Hey%20{{hostName}},%20most%20of%20your%20ad%20trackers%20support%20SSL.%20Why%20don't%20you%3F%20Do%20your%20part%20to%20fight%20mass%20surveillance.%20%23trackerSSL" target="_blank" class="btn" id="b"><i></i><span class="label" id="l">Tweet</span></a>
            </div>
          </div>
		    	{{else}}
		    		Tell {{hostName}} to fix it.</p>
            <div id="widget">
            <div class="btn-o" data-scribe="component:button">
              <a href="https://twitter.com/intent/tweet?text=Hey%20{{hostName}},%20most%20of%20your%20ad%20trackers%20don't%20support%20SSL.%20Consider%20some%20that%20do!%20Do%20your%20part%20in%20fighting%20mass%20surveillance.%20%23trackerSSL" target="_blank" class="btn" id="b"><i></i><span class="label" id="l">Tweet</span></a>
            </div>
          </div>
		    	{{/if}}
		    {{else}}
		    	<p id="trackerCount">No 3rd party trackers on this site.</p>
		    	<p>Since there are no third party dependencies preventing it, why don&lsquo;t you ask {{hostName}} to adopt SSL?</p>
          <div id="widget">
            <div class="btn-o" data-scribe="component:button">
              <a href="https://twitter.com/intent/tweet?text=Hey%20{{hostName}}%20Why%20don't%20you%20do%20your%20part%20in%20the%20fight%20against%20mass%20surveillance%20and%20enable%20HTTPS%20by%20default%3F%20%23trackerssl" target="_blank" class="btn" id="b"><i></i><span class="label" id="l">Tweet</span></a>
            </div>
          </div>
		    {{/if}}
    	{{/if}}
    {{/if}}
    {{#if identifiers}}
      <div class="menu">
        <span id="identifierBtn" class="active">Identifiers</span> | 
        <span id="trackerBtn">All Trackers</span>
      </div>
    {{/if}}
    {{#if identifiers}}
      <div id="identifiers">
      {{#if ssl}}
        <h2 class="good"><i class="fa fa-user"></i> Secure Identifiers</h2>
        <div class="hostsContainer">
        <ul id="badHosts">
        {{#each identifiers}}
            {{#if supportsSSL}}
            <li>
              <span class="unique_key"><i class="fa fa-search"></i> {{this.unique_key}}</span>
              <i class="fa fa-unlock"></i> {{this.hostname}} <span class="identifier">{{this.key_name}}</span>
            </li>
            {{/if}}
        {{/each}}
        {{#each identifiers}}
            {{#if supportsSSL}}
              <!-- -->
            {{else}}
            <li>
              <span class="unique_key"><i class="fa fa-search"></i> {{this.unique_key}}</span>
              <i class="fa fa-ban"></i> {{this.hostname}} <span class="identifier">{{this.key_name}}</span>
            </li>
            {{/if}}
        {{/each}}
        </ul>
        </div>
      {{else}}
        <h2 class="bad"><i class="fa fa-user"></i> Insecure Identifiers</h2>
        <p>Unique IDs about your web browsing habits have been <strong>insecurely sent</strong> to third parties.</p>
        <div class="hostsContainer">
        <ul id="badHosts">
        {{#each identifiers}}
            {{#if @first}}
            <li class="active">
            {{else}}
            <li>
            {{/if}}
              <span class="unique_key"><i class="fa fa-search"></i> {{this.unique_key}}</span>
              {{#if supportsSSL}}
                <i class="fa fa-unlock"></i>
              {{else}}
                <i class="fa fa-ban"></i>
              {{/if}}
              {{this.hostname}} <span class="identifier">{{this.key_name}}</span>
            </li>
        {{/each}}
        </ul>
        <p class="small"><strong>Legend</strong></p>
        <p class="small"><i class="fa fa-unlock"></i> Tracking IDs <strong>could</strong> be sent safely if this site was secure.</p>
        <p class="small"><i class="fa fa-ban"></i> Tracking IDs <strong>do not</strong> support secure transmission.</p>
        </div>
                </div>
        <div id="trackers" style="display:none">
        <h2 class="bad"><i class="fa fa-cloud-upload"></i> All trackers</h2>
        <p>{{uniqueHostsTotal}} third parties know you are on this webpage.</p>
        <div class="hostsContainer">
        <ul>
        {{#each requests}}
            <li>
              {{#if supportsSSL}}
                <i class="fa fa-unlock"></i>
              {{else}}
                <i class="fa fa-ban"></i>
              {{/if}}
              {{this.hostname}}
            </li>
        {{/each}}
        </ul>
                <p class="small"><strong>Legend</strong></p>
        <p class="small"><i class="fa fa-unlock"></i> Tracker <strong>could</strong> be tracking safely if this site was secure.</p>
        <p class="small"><i class="fa fa-ban"></i> Tracker <strong>does not</strong> support secure transmission.</p>
        </div>
      {{/if}}
    {{/if}}
</script>
<script>
  var templates = [];
  var source = document.getElementById('hello-world-template').innerHTML;
  templates['hello'] = Handlebars.compile(source);
</script>
<script>
  window.addEventListener('message', function(event) {
    var command = event.data.command;
    var name = event.data.name || 'hello';
    switch(command) {
      case 'render':
        event.source.postMessage({
          name: name,
          html: templates[name](event.data.context)
        }, event.origin);
       break;
    }
  });
</script>